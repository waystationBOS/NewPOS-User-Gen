<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>User Generator</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<style>
*, *::before, *::after { box-sizing: border-box; }
:root {
  --bg: #eef2f7; --card: #ffffff; --text: #1d3557; --subtext: #333; --border: #d9e1e8;
  --input-bg: #ffffff; --output-bg: #f8fafc; --shadow: rgba(0,0,0,0.12);
}
body.dark {
  --bg: #0f1116; --card: #1a1d24; --text: #e8ecf2; --subtext: #c7cbd1; --border: #2a2f38;
  --input-bg: #1f222a; --output-bg: #16181d; --shadow: rgba(0,0,0,0.5);
}
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: var(--bg); min-height: 100vh;
  display: flex; align-items: center; justify-content: center;
  padding: 20px; color: var(--text);
  transition: background 0.3s ease, color 0.3s ease;
}

/* ðŸ”§ THEME TOGGLE FIXED */
#themeToggle {
  position: fixed; top: 20px; right: 20px;
  background: var(--card); border: 1px solid var(--border);
  padding: 6px 14px; border-radius: 20px;
  font-size: 14px; cursor: pointer; color: var(--text);
  box-shadow: 0 4px 12px var(--shadow);
  transition: 0.3s; z-index: 9999;
  display: inline-flex;    /* <-- shrink to fit */
  width: auto;             /* <-- prevents stretching */
  white-space: nowrap;     /* <-- one line always */
  align-items: center; gap: 8px; font-weight: 600;
}

/* UI */
.container {
  width: 100%; max-width: 460px;
  background: var(--card); padding: 28px;
  border-radius: 14px; box-shadow: 0 12px 35px var(--shadow);
  animation: fadeIn 0.4s ease;
}
@keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

.field { margin-bottom: 18px; }
.field label { font-size: 13px; margin-bottom: 6px; color: var(--subtext); font-weight: 600; display:block; }
.input-wrapper { position: relative; }
.input-wrapper i { position: absolute; top: 50%; left: 12px; transform: translateY(-50%); color: #888; }

input, select {
  width: 100%; padding: 11px 12px 11px 38px;
  border-radius: 8px; border: 1px solid var(--border);
  background: var(--input-bg); color: var(--text);
  font-size: 14px; transition: 0.2s;
}
input:focus, select:focus { border-color: #457b9d; box-shadow: 0 0 0 2px rgba(69,123,157,0.25); }

button {
  width: 100%; padding: 13px; margin-top: 12px;
  border: none; border-radius: 8px;
  background: #1d3557; color: white;
  font-size: 15px; cursor: pointer; font-weight: 600;
}
button:hover { background: #274b7a; }

.copy-btn { background: #2a9d8f; }
.copy-btn:hover { background: #21867a; }

.history-btn { background: #6c5ce7; }
.history-btn:hover { background: #5846d6; }

.output-label { margin-top: 22px; font-size: 12px; font-weight:700; text-transform:uppercase; }
pre {
  margin-top: 8px; padding: 16px; background: var(--output-bg);
  border-radius: 8px; font-family: Consolas, monospace;
  max-height: 220px; overflow-y:auto; border: 1px solid var(--border);
}

/* Slide-out History */
#historyPanel {
  position: fixed; top: 0; right: -400px; width: 350px; height: 100%;
  background: var(--card); box-shadow: -5px 0 20px var(--shadow);
  padding: 20px; transition: right 0.3s ease; overflow-y:auto;
}
#historyPanel.open { right: 0; }

.history-item { background: var(--output-bg); border: 1px solid var(--border); padding: 12px; border-radius: 8px; margin-bottom: 12px; }

/* Toast */
#toast {
  position: fixed; bottom: 25px; right: 25px;
  background: #2a9d8f; color: white; padding: 12px 18px;
  border-radius: 6px; opacity: 0; transition: 0.3s;
}
#toast.show { opacity: 1; }
</style>
</head>

<body>

<button id="themeToggle"><i class="fa-solid fa-moon"></i> Dark</button>

<div class="container">
<h2><i class="fa-solid fa-user-shield"></i> NewPOS61 User Generator</h2>

<div class="field"><label>Badge Number</label>
<div class="input-wrapper"><i class="fa-solid fa-id-badge"></i>
<input id="badge" placeholder="Numeric badge number"></div></div>

<div class="field"><label>Employee Name</label>
<div class="input-wrapper"><i class="fa-solid fa-user"></i>
<input id="name" placeholder="Employee full name"></div></div>

<div class="field"><label>Password</label>
<div class="input-wrapper"><i class="fa-solid fa-key"></i>
<input id="password" placeholder="Numeric password"></div></div>

<div class="field"><label>Job Code</label>
<div class="input-wrapper"><i class="fa-solid fa-briefcase"></i>
<select id="job">
<option value="0">Crew</option>
<option value="86">Manager</option>
<option value="88">General Manager</option>
</select></div></div>

<button onclick="generateSecurityLine()"><i class="fa-solid fa-gear"></i> Generate Security Line</button>
<button class="history-btn" onclick="toggleHistory()"><i class="fa-solid fa-clock-rotate-left"></i> View History</button>

<div class="output-label">Generated Security Line</div>
<pre id="output"></pre>

<button class="copy-btn" onclick="copyOutput()"><i class="fa-solid fa-copy"></i> Copy to Clipboard</button>
<footer>Internal Use Tool</footer>
</div>

<div id="historyPanel"></div>
<div id="toast">Copied!</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>

<script>
/* ----- THEME LOGIC FIXED ----- */
(function(){
  const saved = localStorage.getItem("theme");
  if(saved){ document.body.classList.toggle("dark", saved==="dark"); }
  else { document.body.classList.toggle("dark", window.matchMedia("(prefers-color-scheme: dark)").matches); }
  updateToggleLabel();
})();
function updateToggleLabel() {
  const isDark = document.body.classList.contains("dark");
  document.getElementById("themeToggle").innerHTML =
    isDark ? '<i class="fa-solid fa-sun"></i> Light'
           : '<i class="fa-solid fa-moon"></i> Dark';
}
document.getElementById("themeToggle").onclick = () => {
  document.body.classList.toggle("dark");
  localStorage.setItem("theme", document.body.classList.contains("dark")?"dark":"light");
  updateToggleLabel();
};

/* ----- SECURITY / HASH FUNCTIONS (unchanged) ----- */
function makeMD5Hash(data){var h=CryptoJS.MD5(data).toString();var z='',w=(h.length%2?'0':'')+h;for(var i=0;i<w.length;i++){if(i%2===0){if(w[i]!=='0')z+=w[i];}else z+=w[i];}return z;}
function makeEncryptedPassword(uid,p){var h=CryptoJS.HmacMD5(uid,p).toString();var z='',w=(h.length%2?'0':'')+h;for(var i=0;i<w.length;i++){if(i%2===0){if(w[i]!=='0')z+=w[i];}else z+=w[i];}return z;}
function makeSecurityLine(b,n,p,j){var e=makeEncryptedPassword(b,p);var f=b+','+n.toLowerCase()+','+j+',99991231,'+e+',';return f+makeMD5Hash(f);}

/* ----- UI / TOAST ----- */
function showToast(msg="Copied!"){const t=document.getElementById("toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),1500);}

/* ----- HISTORY ----- */
function loadHistory(){return JSON.parse(localStorage.getItem("history")||"[]");}
function saveHistory(l){localStorage.setItem("history",JSON.stringify(l));}
function addToHistory(t){const l=loadHistory();l.unshift({text:t,time:new Date().toLocaleString()});saveHistory(l);}
function renderHistory(){
  const p=document.getElementById("historyPanel");const l=loadHistory();
  p.innerHTML='<h3 style="margin-bottom:15px;">History</h3>'+ (l.length?'' : '<p>No history yet.</p>');
  l.forEach((x,i)=>{p.innerHTML+=
 `<div class="history-item">
   <div>${x.text}</div>
   <div style="font-size:11px;opacity:0.7;margin-top:6px;">${x.time}</div>
   <div class="history-actions">
     <button onclick="navigator.clipboard.writeText('${x.text}');showToast();">Copy</button>
     <button onclick="deleteHistory(${i})" style="background:#e63946;">Delete</button>
   </div>
 </div>`});
}
function toggleHistory(){const p=document.getElementById("historyPanel");p.classList.toggle("open");renderHistory();}
function deleteHistory(i){const l=loadHistory();l.splice(i,1);saveHistory(l);renderHistory();}

/* ----- GENERATOR ----- */
function generateSecurityLine(){
  const b=badge.value.trim(), n=name.value.trim(), p=password.value.trim(), j=job.value;
  if(!/^\d{1,10}$/.test(b))return alert("Badge: numbers only, max 10");
  if(!/^[a-zA-Z ]{1,25}$/.test(n))return alert("Name: letters only, max 25");
  if(!/^\d{1,10}$/.test(p))return alert("Password: numbers only, max 10");
  const line=makeSecurityLine(b,n,p,j);
  output.textContent=line; addToHistory(line);
}
function copyOutput(){const t=output.textContent;if(!t)return;navigator.clipboard.writeText(t);showToast();}
</script>
</body>
</html>
